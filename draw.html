<!doctype html>
<html>
<head>
    <style>
    #canvas {
        width:400px;
        height:400px;
        border: 0px solid transparent;
        background-color: cornflowerblue;
    }
    .rectangle {
        border: 10px solid #FF0000;
        position: absolute;
    }
    </style>
</head>
<body>
    <div id="canvas"></div>
    <!-- <script src="js/initDraw.js"></script> -->
<script>

var actual_box = null
// contols
SHIFT = 16
SHIFT_PRESSED = false

var left  = 37
var right = 39
var up    = 38
var down  = 40
// letters
var Z = 90
var Q = 81
var S = 83
var D = 68

MOVE_CONTROLS = [left, right, up, down]
RESIZE_CONTROLS = [Z, Q, S, D]

class Box {
    set_as_actuel() {
        set_actual_box(this)
    }
    constructor(x_start, y_start) {
        this.canvas = document.getElementById('canvas')
        this.element = document.createElement('div');
        this.element.className = 'rectangle'
        this.x1 = x_start
        this.y1 = y_start
        this.x2 = null
        this.y2 = null
        this.w = null
        this.h = null
    }
    draw(w, h) {
        console.log("Box.draw()")
        this.w = w
        this.h = h
        this.element.style.width = w + "px"
        this.element.style.height = h + 'px'
        this.element.style.left = this.x1 + 'px'
        this.element.style.top = this.y1 + 'px'
        //this.x2 = x2
        //this.y2 = y2
        console.log("element ", this.element.style.height)
        this.canvas.appendChild(this.element)
    }
    move(key) {
        if (key == left) {
            console.log("move left")
            this.x1 = this.x1 - 5
            this.element.style.left = this.x1  + "px"
        }
        if (key == right) {
            console.log("move right")
            this.x1 = this.x1 + 5
            this.element.style.left = this.x1 + "px"
        }
        if (key == up) {
            console.log("move up")
            this.y1 = this.y1 - 5
            this.element.style.top = this.y1 + "px"
        }
        if (key == down) {
            console.log("move down")
            this.y1 = this.y1 + 5
            this.element.style.top = this.y1 + "px"
        }
    }
    resize(key, shift) {
        if (key == Z) {
            if (!shift){
                console.log("expand up")
                this.h = this.h + 5
                this.element.style.height = this.h  + "px"
                this.move(up)
            }
            else{
                console.log("expand up")
                this.h = this.h - 5
                this.element.style.height = this.h  + "px"
                this.move(down)
            }

        }
        // resize down
        if (key == S) {
            if (!shift) {
                console.log("expand down")
                this.h = this.h + 5
                this.element.style.height = this.h + "px"
            }
            else{
                console.log("expand down")
                this.h = this.h - 5
                this.element.style.height = this.h + "px"               
            }

        }
        // resize left
        if (key == Q) {
            if (!shift) {
                console.log("expand left")
                this.w = this.w + 5
                this.element.style.width = this.w + "px"
                this.move(left)
            }
            else {
                console.log("shrink left")
                this.w = this.w - 5
                this.element.style.width = this.w + "px"
                this.move(right)
            }
        }
        // resize right
        if (key == D) {
            if (!shift){
                console.log("expand right")
                this.w = this.w + 5
                this.element.style.width = this.w + "px"
            }
            else{
                console.log("shrink right")
                this.w = this.w - 5
                this.element.style.width = this.w + "px"
            }
            
        }
    }
}
var b = new Box(200, 200)
console.log("b ", b)
b.draw(100, 100)
actual_box = b

function initDraw(canvas) {
    console.log("canvas in param ", canvas)
    var mouse = {
        x: 0,
        y: 0,
        startX: 0,
        startY: 0
};
function setMousePosition(e) {
    console.log("set mouse position")
    var ev = e || window.event; //Moz || IE
    if (ev.pageX) { //Moz
        mouse.x = ev.pageX + window.pageXOffset;
        mouse.y = ev.pageY + window.pageYOffset;
    } else if (ev.clientX) { //IE
        mouse.x = ev.clientX + document.body.scrollLeft;
        mouse.y = ev.clientY + document.body.scrollTop;
    }
    //console.log("X:", mouse.x, " - Y:", mouse.y)
};

var element = null;    
canvas.onmousemove = function (e) {
    //console.log("onmousemove e.keyCode", e.keyCode)
    setMousePosition(e);
    if (element !== null) {
        element.style.width = Math.abs(mouse.x - mouse.startX) + 'px';
        element.style.height = Math.abs(mouse.y - mouse.startY) + 'px';
        element.style.left = (mouse.x - mouse.startX < 0) ? mouse.x + 'px' : mouse.startX + 'px';
        element.style.top = (mouse.y - mouse.startY < 0) ? mouse.y + 'px' : mouse.startY + 'px';
    }
}

window.onkeydown = function(event) {
    var key = event.keyCode

    console.log("key ", key)

    if (MOVE_CONTROLS.includes(key)) {
        console.log("move control ok")
        actual_box.move(key)
    }
    if (RESIZE_CONTROLS.includes(key)) {
        console.log("resize control ok")
        actual_box.resize(key, event.shiftKey)
    }
}

canvas.onclick = function (e) {
    console.log("canvas.onclick")
    if (element !== null) {
        element = null;
        canvas.style.cursor = "default";
        console.log("finsihed.");
    } else {
        console.log("begun.");
        mouse.startX = mouse.x;
        mouse.startY = mouse.y;
        element = document.createElement('div');
        element.className = 'rectangle'
        element.style.left = mouse.x + 'px';
        element.style.top = mouse.y + 'px';
        canvas.appendChild(element)
        canvas.style.cursor = "crosshair";
    }
}
}

initDraw(document.getElementById('canvas'));

</script>
</body>
</html>